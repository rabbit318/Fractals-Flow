<!DOCTYPE html>
<html>
<head>
    <title>Expert View</title>
    <link rel="stylesheet" href="/expertview-test/expert-view.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script>
        window.FLOWISE_API_BASE_URL = '/api/v1'
        window.INTERNAL_REQUEST = true
    </script>
    <style>
        /* Add some basic styles to ensure sections are visible */
        .expert-container {
            display: flex;
            height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 0;
        }
        .source-column, .chat-column {
            flex: 1;
            padding: 20px;
            border: 1px solid #ccc;
            min-height: 100%;
            overflow-y: auto;
        }
        .source-column {
            background: #f5f5f5;
            border-right: 1px solid #e0e0e0;
        }
        h2 {
            margin-top: 0;
            margin-bottom: 20px;
        }
        /* Add to existing styles */
        .chat-feedback {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            margin-top: auto;
        }

        .vote-button {
            border: none;
            background: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s;
            color: #666;
        }

        .vote-button:hover {
            background: #f5f5f5;
            color: #333;
        }

        .vote-button.active {
            background: #e0e0e0;
            color: #000;
        }

        .vote-button svg {
            display: block;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const ThumbUpIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
            </svg>
        );

        const ThumbDownIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2h-3"></path>
            </svg>
        );

        const ExpertView = () => {
            const [sources, setSources] = useState([])
            const [chatVote, setChatVote] = useState(null)
            const chatflowid = window.location.pathname.split('/').pop()

            const handleChatVote = (vote) => {
                setChatVote(vote)
            }

            useEffect(() => {
                // Fetch sources from API
                fetch(`${window.FLOWISE_API_BASE_URL}/chatflows/${chatflowid}/sources`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'x-request-from': 'internal'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    setSources(data)
                })
            }, [])

            return (
                <div className="expert-container">
                    <div className="source-column">
                        <h2>Source Documents</h2>
                        <div className="source-list">
                            {sources.map((source, index) => (
                                <div key={index} className="source-item">
                                    <h3>{source.title}</h3>
                                    <p>{source.preview}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="chat-column">
                        <h2>Chat Interface</h2>
                        <div className="chat-content">Chat content will go here</div>
                        <div className="chat-feedback">
                            <button 
                                onClick={() => handleChatVote('up')}
                                className={`vote-button ${chatVote === 'up' ? 'active' : ''}`}
                                title="Helpful"
                            >
                                <ThumbUpIcon />
                            </button>
                            <button 
                                onClick={() => handleChatVote('down')}
                                className={`vote-button ${chatVote === 'down' ? 'active' : ''}`}
                                title="Not Helpful"
                            >
                                <ThumbDownIcon />
                            </button>
                        </div>
                    </div>
                </div>
            )
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<ExpertView />)
    </script>
</body>
</html>